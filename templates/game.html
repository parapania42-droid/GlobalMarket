{% extends "base.html" %}

{% block content %}
    <!-- Mini-Event Popup -->
    <div id="event-popup" class="event-popup" style="display:none;">
        <div class="event-content">
            <div class="event-title" id="event-title">Etkinlik</div>
            <div class="event-desc" id="event-desc">Yeni bir mini etkinlik aktif!</div>
            <div class="event-actions">
                <button class="btn btn-success btn-sm" id="event-claim-btn">Ã–DÃœLÃœ AL</button>
                <button class="btn btn-secondary btn-sm" id="event-close-btn">Kapat</button>
            </div>
        </div>
    </div>

    <!-- HUD was moved to base.html -->
    <!-- We add an ID to this container so main.js knows it's the game page? 
         Actually main.js checks window.location.pathname.
         But for rendering, we need the containers.
    -->
    <div class="container main-game-area" id="game-page-container">
        <div class="card" style="margin-bottom:15px;">
            <div class="card-header">
                <h2>ğŸ“Š Genel Durum</h2>
            </div>
            <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;">
                <div class="inventory-item"><div>ğŸ’° Para</div><div id="dash-money" style="font-weight:bold">0 TL</div></div>
                <div class="inventory-item"><div>â­ Seviye</div><div id="dash-level" style="font-weight:bold">1</div></div>
                <div class="inventory-item"><div>ğŸ¦ Toplam VarlÄ±k</div><div id="dash-assets" style="font-weight:bold">0 TL</div></div>
                <div class="inventory-item"><div>ğŸ‘· Ä°ÅŸÃ§i SayÄ±sÄ±</div><div id="dash-workers" style="font-weight:bold">0</div></div>
                <div class="inventory-item"><div>ğŸ—ï¸ Arazi</div><div id="dash-land" style="font-weight:bold">0</div></div>
                <div class="inventory-item"><div>ğŸ­ Fabrika</div><div id="dash-factories" style="font-weight:bold">0</div></div>
            </div>
        </div>
        <div style="display:flex; justify-content:flex-end; margin-bottom:10px;">
             <button id="daily-bonus-btn" class="btn btn-sm btn-warning" onclick="claimDailyBonus()" style="display:none;">ğŸ GÃœNLÃœK Ã–DÃœL</button>
        </div>

        <!-- AFK UyarÄ±sÄ± -->
        <div id="active-status" style="display:none; background:var(--danger); color:white; padding:10px; border-radius:5px; margin-bottom:15px; text-align:center; font-weight:bold; animation:pulse 1s infinite;"></div>
        
        <!-- Ekonomi Durum BannerÄ± -->
        <div id="economy-status" class="economy-banner">
            KÃ¼resel pazara baÄŸlanÄ±lÄ±yor...
        </div>

        <div class="game-grid">
            <!-- SOL KOLON: PAZAR -->
            <div class="column-market" id="market">
                <div class="card">
                    <div class="card-header">
                        <h2>ğŸ›’ CanlÄ± Pazar</h2>
                        <div class="market-controls">
                            <button class="btn btn-xs" onclick="setSort('time')">YENÄ°</button>
                            <button class="btn btn-xs" onclick="setSort('price')">UCUZ</button>
                            <button class="btn btn-xs" onclick="setSort('item')">Ä°SÄ°M</button>
                        </div>
                    </div>
                    
                    <div class="market-list" id="market-list">
                        <!-- JS ile doldurulacak -->
                    </div>
                </div>
            </div>

            <!-- ORTA KOLON: ENVANTER & SATIÅ -->
            <div class="column-inventory">
                 <!-- Dashboard Widgets -->
                 <div class="card">
                    <div class="card-header">
                        <h3>ğŸ“ˆ Piyasa Trendleri</h3>
                    </div>
                    <div id="trend-box" class="hint-text">Veriler yÃ¼kleniyor...</div>
                 </div>
                 <div class="card">
                    <div class="card-header"><h3>ğŸ’¹ Son KazanÃ§lar</h3></div>
                    <div id="earnings-box" class="hint-text">HenÃ¼z iÅŸlem yok.</div>
                 </div>
                 <div class="card">
                    <div class="card-header"><h3>ğŸ› ï¸ Sistem MesajlarÄ±</h3></div>
                    <div id="system-box" class="hint-text">Her ÅŸey yolunda.</div>
                 </div>
                 <!-- GÃ¶rev -->
                 <div class="card mission-card" id="mission-box" style="display:none">
                    <!-- GÃ¶rev JS ile buraya gelecek -->
                </div>

                 <!-- VarlÄ±klarÄ±m -->
                 <div class="card">
                    <h3>ğŸ’ Envanterim</h3>
                    <div id="net-worth" class="net-worth">Net Servet: 0 TL</div>
                    <div class="inventory-grid" id="inventory-list">
                        <!-- Envanter JS ile buraya gelecek -->
                    </div>
                </div>

                <!-- SatÄ±ÅŸ Yap -->
                <div class="card">
                    <h3>â• SatÄ±ÅŸ Yap</h3>
                    <div class="sell-form">
                        <select id="sell-item" class="form-input"></select>
                        <div class="input-group">
                            <input type="number" id="sell-qty" placeholder="Adet" class="form-input">
                            <input type="number" id="sell-price" placeholder="Fiyat" class="form-input">
                        </div>
                        <button class="btn btn-primary btn-block" onclick="sellItem()">SATIÅA KOY</button>
                    </div>
                </div>

                <!-- Lojistik (Seferler) -->
                <div class="card">
                    <h3>ğŸšš Lojistik Merkezi</h3>
                    <div id="expedition-active" style="display:none; text-align:center; padding:10px; background:rgba(0,0,0,0.2); border-radius:5px;">
                        <div id="exp-timer" style="font-size:1.2em; font-weight:bold; margin-bottom:5px;">00:00</div>
                        <div id="exp-status" style="color:var(--text-muted)">Seferde...</div>
                        <button id="exp-collect-btn" class="btn btn-success btn-block" style="margin-top:10px; display:none;" onclick="collectExpedition()">Ã–DÃœLÃœ AL</button>
                    </div>
                    
                    <div id="expedition-list">
                        <div class="exp-item" onclick="startExpedition('short')">
                            <div style="font-weight:bold">KÄ±sa Mesafe</div>
                            <div style="font-size:0.8em">SÃ¼re: 5dk | Maliyet: 100 TL</div>
                        </div>
                        <div class="exp-item" onclick="startExpedition('medium')">
                            <div style="font-weight:bold">Orta Mesafe</div>
                            <div style="font-size:0.8em">SÃ¼re: 15dk | Maliyet: 500 TL</div>
                        </div>
                        <div class="exp-item" onclick="startExpedition('long')">
                            <div style="font-weight:bold">Uzun Mesafe</div>
                            <div style="font-size:0.8em">SÃ¼re: 60dk | Maliyet: 2000 TL</div>
                        </div>
                    </div>
                </div>

                <!-- Finans (Risk) -->
                <div class="card">
                    <h3>ğŸ“ˆ Risk Sermayesi</h3>
                    <p class="hint-text" style="font-size:0.8em">ParanÄ± ikiye katla ya da kaybet! (%50 Åans)</p>
                    <div class="input-group">
                        <input type="number" id="venture-amount" placeholder="Miktar" class="form-input">
                        <button class="btn btn-danger" onclick="playVenture()">RÄ°SK AL</button>
                    </div>
                </div>
            </div>

            <!-- SAÄ KOLON: FABRÄ°KALAR -->
            <div class="column-factories" id="factories">
                <div class="card">
                    <h3>ğŸ­ FabrikalarÄ±m</h3>
                    <p class="hint-text">Depo dolmadan toplamayÄ± unutma!</p>
                    <div id="factory-list">
                        <!-- JS ile doldurulacak -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CHAT BOX -->
    <div class="chat-container">
        <div class="chat-header" onclick="toggleChat()">
            ğŸ’¬ Global Sohbet
        </div>
        <div class="chat-body" id="chat-body">
            <div id="chat-messages" class="chat-messages">
                <!-- Mesajlar -->
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="Mesaj yaz..." onkeypress="handleChatKey(event)">
                <button onclick="sendChat()">GÃ¶nder</button>
            </div>
        </div>
    </div>

    <!-- FACTORY MODAL TEMPLATE -->
    <div id="factory-modal" class="modal-overlay" style="display:none;" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2 id="modal-title">Fabrika <span id="modal-level-badge" style="font-size:0.6em; color:var(--primary)">Lv. 0</span></h2>
                <button class="btn btn-sm btn-danger" onclick="closeModal()">X</button>
            </div>
            
            <div class="modal-body">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <div>
                        <div>Ãœretim: <span id="modal-rate" style="color:var(--success)">0/dk</span></div>
                        <div>Depo: <span id="modal-storage">0</span> / <span id="modal-capacity">0</span></div>
                    </div>
                    <div style="text-align:right">
                         <div id="modal-status-text">Durum: Normal</div>
                         <button id="modal-boost-btn" class="btn btn-sm btn-warning">
                             âš¡ HIZLANDIR (1dk)
                         </button>
                    </div>
                </div>

                <div class="progress-bar">
                    <div id="modal-progress" class="progress-fill" style="width: 0%"></div>
                </div>
                
                <div style="margin-top:20px; padding:15px; background:rgba(0,0,0,0.2); border-radius:8px;">
                    <h4>YÃ¼kseltme</h4>
                    <p>Maliyet: <span id="modal-cost-text"></span></p>
                    <p id="modal-next-stats" style="font-size:0.9em; color:var(--text-muted)">Yeni Kapasite: - | Yeni HÄ±z: -</p>
                    <button id="modal-upgrade-btn" class="btn btn-primary" style="width:100%">
                        YÃœKSELT
                    </button>
                </div>

                <div style="margin-top:10px;">
                     <button id="modal-collect-btn" class="btn btn-success" style="width:100%; padding:15px;">
                        ğŸ“¦ DEPOYU TOPLA
                     </button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
